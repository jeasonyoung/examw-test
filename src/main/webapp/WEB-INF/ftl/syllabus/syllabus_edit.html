<#--大纲编辑-->
<#include "comm.ftl"/>
<#assign module="syllabus_syllabus"/>
<#assign form="${module}_edit_form"/>
<script type="text/javascript">
<!--
$(function(){
	//exam-tree
	var current_exam_select = 0;
	var exam_tree = $("#${form} input[name='examId']").combotree({
		url:"<@s.url '/settings/category/exams-tree'/>",
		required:true,
		onLoadError:function(e){
				<@error_dialog "e"/>
		},
		onLoadSuccess:function(){
			var id = "${CURRENT_EXAM_ID}";
			if($.trim(id) == "") return;
			exam_tree.combotree("setValue",id);
		},
		onSelect:function(record){
			current_exam_select = current_exam_select + 1;
			if(current_exam_select == 1 && "${CURRENT_EXAM_ID}" == record.id) return;
			if(subject_cbb){
				subject_cbb.combobox("reload","<@s.url '/settings/subject/all'/>?examId=" + record.id);
			}
		}
	});
	//subject-tree
	var subject_cbb = $("#${form} input[name='subId']").combobox({
		<#if ((CURRENT_EXAM_ID?length) > 0)>
	     url:"<@s.url '/settings/subject/all'/>?examId=${CURRENT_EXAM_ID}",
	   </#if>
		required:true,
		valueField:"id",
		textField:"name",
		onLoadError:function(e){
			<@error_dialog 'e'/>
		},
		onLoadSuccess:function(){
			subject_cbb.combobox("clear");
			var id = "${CURRENT_SUBJECT_ID}";
			if($.trim(id) == "" || current_exam_select > 1) return;
			subject_cbb.combobox("setValue",id);
		},
		onSelect:function(record){
			if(parent_syllabus_cbt && "${CURRENT_SUBJECT_ID}"!= record.id ){
				syllabusId ="";
				parent_syllabus_cbt.combotree("reload","<@s.url '/syllabus/syllabus/tree/'/>"+record.id);
			}
		}
	});
	//parent syllabus
	var syllabusId = "${CURRENT_SYLL_PID}";
	var parent_syllabus_cbt = $("#${form} input[name='pid']").combotree({
		<#if (CURRENT_SUBJECT_ID?length>0)>
		url:"<@s.url '/syllabus/syllabus/tree/${CURRENT_SUBJECT_ID}?ignore='/><#if (CURRENT_SYLL_ID?length > 0)>${CURRENT_SYLL_ID}</#if>",
		</#if>
		lines:true,
		onLoadError:function(e){
			<@error_dialog "e"/>
		},
		onLoadSuccess:function(){
			parent_syllabus_cbt.combotree("clear");
			var id = syllabusId;
			if($.trim(id) == "") return;
			parent_syllabus_cbt.combotree("setValue",id);
		}
	});
});
//-->
</script>
<form id="${form}" method="POST" style="padding:10px;">
	<div style="float:left;margin-top:2px;width:100%;">
		<label style="width:75px;">上级要点：</label>
		<input type="text" name="pid" style="width:319px;"/>
	</div>
	<div style="float:left;margin-top:15px;width:100%;">
		<label style="width:75px;">所属科目：</label>
		<input name="examId" type="text"  style="width:154px;"/>
		<input name="subId" type="text"  style="width:160px;"/>
		<input type="hidden" name="id">
	</div> 
	<div style="float:left; margin-top:15px; width:100%;">
		<label style="width:75px;">要点代码：</label>
		<input type="text" name="code" class="easyui-validatebox"  data-options="required:true" style="width:315px;"/>
	</div>
	<div style="float:left; margin-top:15px; width:100%;">
		<label style="width:75px;">要点名称：</label>
		<input type="text" name="title" class="easyui-validatebox"  data-options="required:true" style="width:315px;"/>
	</div>
</form>