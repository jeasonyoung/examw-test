<#--科目设置编辑-->
<#include "comm.ftl"/>
<#assign module="products_software"/>
<#assign form="${module}_edit_form"/>
<script type="text/javascript">
<!--
$(function(){
	//fileupload
	var upload = $("#${form}_file_upload").uploadify({
		swf:"<@s.url '/resources/uploadify/uploadify.swf'/>",
		uploader:"<@s.url '/upload'/>",
		method:"POST",
		fileObjName:"file",
		buttonText:"上传图片",
		height:20,
		multi:false,
		fileExt:"*.jpg",
		fileDesc:"请选择jpg图片文件上传",
		uploadLimit:1024000,//10M
		auto:true,
		queueID:"${form}_file_queue",
		onUploadError : function(file, errorCode, errorMsg){
			alert(file);
			//console.info(file);
			$.messager.show({
				title:"上传文件异常",
				msg:errorCode + "|" + errorMsg
			});
		},
		onUploadSuccess:function(file, data, response){
			if(!data){
				$.messager.show({
					title:"上传文件失败",
					msg:"服务器端发生异常，未反馈数据！"
				});
				return;
			}
			var result = $.parseJSON(data)
			if(result){
				$("#${form} img").attr("src", root + result.url);
				$("#${form} input[name='imgUrl']").val(result.url);
			}
		}
	});
	//change
	$("#${module}_edit_form input[name='imgUrl']").change(function(data){
		if(data){
			$("#${form} img").attr("src", root + $(data.target).val());	
		}
	});
	var current_category_select = false;
	//分类树
	//category__exam_tree
	var c_t = $("#${module}_edit_form input[name='examId']").combotree({
		url:"<@s.url '/settings/category/exams-tree'/>",
		required:true,
		valueField:"id",
		textField:"name",
		onLoadError:function(e){
			<@error_dialog "e"/>
		},
		onLoadSuccess:function(){
			var id = "${CURRENT_EXAM_ID}";
			if($.trim(id) == "") return;
			c_t.combotree("setValue",id);
		},
		onSelect:function(record){
			current_category_select = true;
			if(p_t && "${CURRENT_EXAM_ID}"!= record.id ){
				p_t.combobox("clear");
				p_t.combobox("reload","<@s.url '/products/product/combo'/>?examId=" + record.id);
			}
		}
	});
	//产品下拉
	//product_tree
	var p_t = $("#${module}_edit_form input[name='productId']").combobox({
		url:"<@s.url '/products/product/combo'/>?examId=${CURRENT_EXAM_ID}",
		required:true,
		valueField:"id",
		textField:"name",
		onLoadError:function(e){
			<@error_dialog "e"/>
		},
		onLoadSuccess:function(){
			var id = "${CURRENT_PRODUCT_ID}";
			if($.trim(id) == "") return;
			p_t.combobox("setValue",id);
		}
	});
	//渠道下拉
	var ch_t = $("#${module}_edit_form input[name='channelId']").combobox({
		url:"<@s.url '/products/channel/combo'/>",
		valueField:"id",
		textField:"name",
		onLoadError:function(e){
			<@error_dialog "e"/>
		},
		onLoadSuccess:function(){
			var id = "${CURRENT_CHANNEL_ID}";
			if($.trim(id) == "") return;
			ch_t.combobox("setValue",id);
		}
	});
	//软件类型下拉
	var r_t = $("#${module}_edit_form input[name='softTypeId']").combobox({
		url:"<@s.url '/products/softwaretype/combo'/>",
		valueField:"id",
		textField:"name",
		onLoadError:function(e){
			<@error_dialog "e"/>
		},
		onLoadSuccess:function(){
			var id = "${CURRENT_TYPE_ID}";
			if($.trim(id) == "") return;
			r_t.combobox("setValue",id);
		}
	});
});
//-->
</script>

<form id="${module}_edit_form" method="POST" style="padding:10px;">
	<div style="float:left;margin-top:10px;width:98%;">
		<div style="float:left;width:205px;height:190px;margin-left:5px;padding:1px;text-align:center;border:solid 1px #ccc;">
			<div style="width:200px;height:160px;">
				<div id="${form}_file_queue"  style="position:absolute;border:solid 0px red;"></div>
				<img src="http://c.hiphotos.baidu.com/image/pic/item/48540923dd54564e58890687b1de9c82d0584fa4.jpg" alt="宣传图片" width="200" height="150" style="border:solid 1px red;">
			</div>
			<input id="${form}_file_upload" name="file" type="file"/>
			<input type="hidden" name="imgUrl" />
		</div>
		<div style="float:left;margin-left:5px;width:380px;">
			<div style="float:left;">
				<label style="width:100px;">软件名称：</label>
				<input type="text" name="name" class="easyui-validatebox"  style="width:270px;" data-options="required:true"/>
				<input type="hidden" name="id"/>
			</div>
			<div style="float:left;margin-top:10px;">
				<label style="width:100px;">软件类型：</label>
				<input name="softTypeName" type="hidden"/>
		    	<input name="softTypeId" id="${module}_softType_combobox" style="width:274px;"/>
			</div>
			<div style="float:left;margin-top:10px;">
				<label style="width:100px;">渠道：</label>
		    	<input name="channelId" id="${module}_channel_combobox" style="width:274px;" />
			</div>
			<div style="float:left;margin-top:10px;">
				<label style="width:100px;">代码：</label>
		    	<input type="text" name="code" class="easyui-validatebox" style="width:270px;" data-options="required:true"/>
			</div>
			<div style="float:left;margin-top:10px;">
				 <label style="width:100px;">版本：</label>
		      	 <input type="text" name="version" class="easyui-numberbox" data-options="editable:true" style="width:274px;" />
			</div>
			<div style="float:left;margin-top:10px;">
				 <label style="width:100px;">下载地址：</label>
		      	 <input type="text" name="version" class="easyui-validatebox" data-options="" style="width:270px;" />
			</div>
			<div style="float:left;margin-top:10px;">
				<label style="width:100px;">所属考试：</label>
				<input type="text" name="examId" style="width:274px;">
			</div>
			<div style="float:left;margin-top:10px;">
				<label style="width:100px;">所属产品：</label>
				<input type="text" name="productId" style="width:274px;"/>
			</div>
		</div>
	</div>
	<div style="float:left;margin-top:12px;width:100%;">
		<label style="width:75px;">软件介绍：</label>
		<textarea name="content" class="easyui-kindeditor" data-options="minWidth:610,minHeight:120" row="15" cols="20"/>
	</div>
</form>
