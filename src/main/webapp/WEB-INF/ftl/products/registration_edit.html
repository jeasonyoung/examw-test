<#--科目设置编辑--> <#include "comm.ftl"/> <#assign
module="products_registration"/> <#assign form="${module}_edit_form"/>
<script type="text/javascript">
<!--
	$(function() {
		var current_category_select = 0;
		//分类树
		//category__exam_tree
		var c_t = $("#${module}_edit_form input[name='examId']").combotree(
				{
					url : "<@s.url '/settings/category/exams-tree'/>",
					required : true,
					valueField : "id",
					textField : "name",
					onLoadError : function(e) {
						<@error_dialog "e"/>
					},
					onLoadSuccess : function() {
						var id = "${CURRENT_EXAM_ID}";
						if ($.trim(id) == "")
							return;
						c_t.combotree("setValue", id);
					},
					onSelect : function(record) {
						current_category_select = current_category_select + 1;
						if (current_category_select == 1
								&& "${CURRENT_EXAM_ID}" == record.id)
							return;
						if (p_t) {
							p_t.combobox("clear");
							p_t.combobox("reload",
									"<@s.url '/products/product/combo'/>?examId="
											+ record.id);
						}
					}
				});
		//产品下拉
		//product_tree
		var p_t = $("#${module}_edit_form input[name='productId']")
				.combobox(
						{
							url : "<@s.url '/products/product/combo'/>?examId=${CURRENT_EXAM_ID}",
							required : true,
							valueField : "id",
							textField : "name",
							onLoadError : function(e) {
								<@error_dialog "e"/>
							},
							onLoadSuccess : function() {
								var id = "${CURRENT_PRODUCT_ID}";
								if ($.trim(id) == "")
									return;
								p_t.combobox("setValue", id);
							}
						});
		//渠道下拉
		var ch_t = $("#${module}_edit_form input[name='channelId']").combobox({
			url : "<@s.url '/products/channel/combo'/>",
			valueField : "id",
			textField : "name",
			onLoadError : function(e) {
				<@error_dialog "e"/>
			},
			onLoadSuccess : function() {
				var id = "${CURRENT_CHANNEL_ID}";
				if ($.trim(id) == "")
					return;
				ch_t.combobox("setValue", id);
			}
		});
		${module}_chooseProduct = function(){
			var code = "";
			var row = null;
			var d = $("<div/>").dialog({
				title:'选择产品',
				width:800,
				height:600,
				href:"<@s.url '/products/registration/chooseproduct'/>?productId="+$("#${module}_edit_form input[name='relationProductId']").val(),
				modal:true,
				buttons:[
				  {
					text:"保存",
					iconCls:"icon-save",
					handler:function(){
						var ids = products_registration_choose_list_dg_get_value("id");
						if(ids == 0){ 
							d.dialog("close");
							return; 
						}
						var names = products_registration_choose_list_dg_get_value("name");
						$("#${module}_edit_form input[name='relationProductId']").val(ids);
						$("#${module}_edit_form input[name='relationProductName']").val(names);
						d.dialog("close");
					}
				},
				{
					text:"关闭",
					iconCls:"icon-cancel",
					handler:function(){
						d.dialog("close");
					}
				}],
				onClose:function(){
					$(this).dialog("destroy");
				},
				onLoad:function(){
					if(code && !row){
						$("#${module}_edit_form").form("load",{"code":code});
						return;
					}
					if(row) $("#${module}_edit_form").form("load",row);
				}
			});
		}
	});
//-->
</script>

<form id="${module}_edit_form" method="POST" style="padding: 10px;">
		<div style="float: left;">
			<label style="width: 100px;">关联产品：</label> 
			<input type="hidden" name="relationProductId"/>
			<input type="text"	name="relationProductName" class="easyui-validatebox" style="width: 270px;" data-options="required:true" />
			<a href="#" class="easyui-linkbutton" onclick="${module}_chooseProduct()" style="width: 50px;" >选择</a> 
			<input type="hidden" name="id" />
		</div>
		<div style="float: left; margin-top: 12px;">
			<label style="width: 100px;">期限(月)：</label> 
			<input name="limitTime" class="easyui-numberbox" data-options="editable:true,min:0" style="width: 274px;" />
		</div>
		<div style="float: left; margin-top: 12px;">
			<label style="width: 100px;">渠道：</label> 
			<input name="channelId"	id="${module}_channel_combobox" style="width: 274px;" />
		</div>
		<div style="float: left; margin-top: 12px;">
			<label style="width: 100px;">原价：</label> 
			<input type="text"	name="price" class="easyui-numberbox" data-options="editable:true,min:0,precision:2"	style="width: 274px;" />
		</div>
		<div style="float: left; margin-top: 12px;">
			<label style="width: 100px;">优惠价：</label>
			<input type="text" name="discount" class="easyui-numberbox" data-options="editable:true,min:0,precision:2"	style="width: 270px;" />
		</div>
		<div style="float: left; margin-top: 12px;">
			<label style="width: 100px;">到期时间：</label>
			<input type="text" name="endTime" class="easyui-datebox" data-options="panelWidth:270"	style="width: 270px;" />
		</div>
</form>
