<#--科目设置编辑--> <#include "comm.ftl"/> 
<#assign module="products_registration"/> 
<#assign form="${module}_edit_form"/>
<#assign dg="${module}_softlimit_dg"/>
<script type="text/javascript">
<!--
	$(function() {
		//渠道下拉
		var ch_t = $("#${module}_edit_form input[name='channelId']").combobox({
			url : "<@s.url '/products/channel/combo'/>",
			valueField : "id",
			textField : "name",
			onLoadError : function(e) {
				<@error_dialog "e"/>
			},
			onLoadSuccess : function() {
				var id = "${CURRENT_CHANNEL_ID}";
				if ($.trim(id) == "")
					return;
				ch_t.combobox("setValue", id);
			}
		});
		${module}_chooseProduct = function(){
			var code = "";
			var row = null;
			var d = $("<div/>").dialog({
				title:'选择产品',
				width:800,
				height:600,
				href:"<@s.url '/products/registration/chooseproduct'/>?productId="+$("#${module}_edit_form input[name='productId']").val(),
				modal:true,
				buttons:[
				  {
					text:"保存",
					iconCls:"icon-save",
					handler:function(){
						var ids = products_registration_choose_list_dg_get_value("id");
						if(ids == 0){ 
							$("#${module}_edit_form input[name='productId']").val("");
							$("#${module}_product_name").textbox("clear");
							d.dialog("close");
							return; 
						}
						var names = products_registration_choose_list_dg_get_value("name");
						$("#${module}_edit_form input[name='productId']").val(ids);
						$("#${module}_product_name").textbox("setValue",names);
						d.dialog("close");
					}
				},
				{
					text:"关闭",
					iconCls:"icon-cancel",
					handler:function(){
						d.dialog("close");
					}
				}],
				onClose:function(){
					$(this).dialog("destroy");
				},
				onLoad:function(){
					if(code && !row){
						$("#${module}_edit_form").form("load",{"code":code});
						return;
					}
					if(row) $("#${module}_edit_form").form("load",row);
				}
			});
		}
	});
var dg=$("#${dg}").datagrid({
	width:400,
	heigth:100,
	fitColumns:true,
	rownumbers:true,
	border:true,
	striped:true,
	idField:"opt_id",
	columns:[[{
		field:"opt_id",
		checkbox:true
	},{
		title:"软件类型",
		field:"softwareType",
		width:20,
		align:"left",
		formatter: function(value,row,index){
			return $.trim(value);
		}
	},{
		title:"绑定次数",
		field:"time",
		width:10,
		align:"center"
	}]],
	toolbar:"#${dg}_toolbar",
	onLoadError:function(e){
		<@error_dialog "e"/>
	},
	onDblClickRow:function(rowIndex,rowData){
		edit_window("编辑选项",rowIndex,rowData);
	}
});
//-->
</script>

<form id="${module}_edit_form" method="POST" style="padding: 10px;">
		<div style="float: left;">
			<label style="width: 100px;">关联产品：</label> 
			<input type="hidden" name="productId"/>
			<input id = "${module}_product_name" name="productName" class="easyui-textbox" data-options="buttonText:'选择 ',prompt:'选择产品',missingMessage:'请选择产品',icons:[{iconCls:'icon-clear',handler:function(e){$(e.data.target).textbox('clear');$('#${module}_edit_form input[name=\'productId\']').val('');}}],width:274,onClickButton:${module}_chooseProduct" />
			<input type="hidden" name="id" />
		</div>
		<div style="float: left; margin-top: 12px;">
			<label style="width: 100px;">期限(月)：</label> 
			<input name="limitTime" class="easyui-numberbox" data-options="editable:true,min:0" style="width: 274px;" />
		</div>
		<div style="float: left; margin-top: 12px;">
			<label style="width: 100px;">渠道：</label> 
			<input name="channelId"	id="${module}_channel_combobox" style="width: 274px;" />
		</div>
		<div style="float: left; margin-top: 12px;">
			<label style="width: 100px;">原价：</label> 
			<input type="text"	name="price" class="easyui-numberbox" data-options="editable:true,min:0,precision:2"	style="width: 274px;" />
		</div>
		<div style="float: left; margin-top: 12px;">
			<label style="width: 100px;">优惠价：</label>
			<input type="text" name="discount" class="easyui-numberbox" data-options="editable:true,min:0,precision:2"	style="width: 270px;" />
		</div>
		<div style="float: left; margin-top: 12px;">
			<label style="width: 100px;">到期时间：</label>
			<input type="text" name="endTime" class="easyui-datebox" data-options="panelWidth:270"	style="width: 270px;" />
		</div>
		<div style="float: left; margin-top: 12px;">
		<table id="${dg}"></table>
		<div id="${dg}_toolbar">
			<a href="#" class="easyui-linkbutton" onclick="${dg}_add()" data-options="iconCls:'icon-add',plain:true" style="float:left;">新增软件限制</a>
			<span>|</span>
			<a href="#" class="easyui-linkbutton" onclick="${dg}_delete()" data-options="iconCls:'icon-remove',plain:true">删除</a>
		</div>
		</div>
</form>
